<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Rangos de Subred Optimizada</title>
    <style>
        /* RESET Y ESTILOS GENERALES */
        /* Aplicamos box-sizing border-box a todos los elementos para un cálculo más predecible de dimensiones */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        /* Estilos para el cuerpo de la página */
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }

        /* Contenedor principal que centra el contenido y le da estilo de tarjeta */
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            padding: 30px;
        }

        /* ESTILOS DE TIPOGRAFÍA Y ENCABEZADOS */
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid #3498db;
        }

        /* ESTILOS DE FORMULARIO Y ENTRADAS */
        .input-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }

        input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        /* Efecto de foco en los inputs */
        input:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 5px rgba(52, 152, 219, 0.5);
        }

        /* ESTILOS DE BOTONES */
        .btn {
            display: block;
            width: 100%;
            padding: 14px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-top: 20px;
        }

        .btn:hover {
            background-color: #2980b9;
        }

        /* ESTILOS DE RESULTADOS */
        .resultados {
            margin-top: 30px;
            display: none;
            /* Oculto inicialmente */
        }

        .resultados h2 {
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        /* ESTILOS DE TABLA */
        .tabla-redes {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 14px;
        }

        .tabla-redes th {
            background-color: #3498db;
            color: white;
            padding: 12px;
            text-align: left;
        }

        .tabla-redes td {
            padding: 10px;
            border-bottom: 1px solid #eee;
        }

        /* Filas pares con color de fondo alternativo para mejor legibilidad */
        .tabla-redes tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        /* ESTILOS DE MENSAJES DE ERROR E INFORMACIÓN */
        .error {
            color: #e74c3c;
            margin-top: 5px;
            font-size: 14px;
            display: none;
            /* Oculto inicialmente */
        }

        .info {
            background-color: #e8f4fc;
            border-left: 4px solid #3498db;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 0 5px 5px 0;
        }

        .info h3 {
            margin-bottom: 10px;
            color: #2c3e50;
        }

        /* ESTILOS DE INFORMACIÓN DE CLASES DE RED */
        .clase-info {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .clase-card {
            flex: 1;
            min-width: 200px;
            margin: 10px;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: all 0.3s;
        }

        /* Colores específicos para cada clase de red */
        .clase-a {
            background-color: #e8f6f3;
            border-left: 4px solid #1abc9c;
        }

        .clase-b {
            background-color: #fef9e7;
            border-left: 4px solid #f1c40f;
        }

        .clase-c {
            background-color: #f4ecf7;
            border-left: 4px solid #9b59b6;
        }

        /* Efecto de tarjeta activa */
        .clase-activa {
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .detalle-clase {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 5px;
            display: none;
            /* Oculto inicialmente */
        }

        /* ESTILOS DE RESUMEN DE RED */
        .resumen-red {
            background-color: #e8f4fc;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .resumen-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .resumen-item strong {
            color: #2c3e50;
        }

        /* CONTENEDOR PARA TABLA RESPONSIVA */
        .tabla-contenedor {
            width: 100%;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-top: 15px;
            background: white;
        }

        /* MEDIA QUERIES PARA DISEÑO RESPONSIVE */
        /* Estilos para tablets y móviles (hasta 768px) */
        @media (max-width: 768px) {
            .tabla-redes {
                width: auto;
                min-width: 100%;
                font-size: 12px;
                border-collapse: collapse;
                margin: 0;
            }

            .tabla-redes th,
            .tabla-redes td {
                padding: 10px 8px;
                text-align: left;
                border-bottom: 1px solid #eee;
                white-space: nowrap;
                min-width: 120px;
            }

            .tabla-redes th {
                background-color: #3498db;
                color: white;
                font-weight: bold;
                position: sticky;
                left: 0;
                z-index: 2;
            }

            .tabla-redes th:first-child {
                left: 0;
                min-width: 80px;
            }

            .tabla-redes td {
                background-color: white;
            }

            .tabla-redes tr:nth-child(even) td {
                background-color: #f8f9fa;
            }

            /* Eliminar cualquier espacio blanco */
            .tabla-redes {
                border-spacing: 0;
            }

            /* Personalización de la barra de desplazamiento */
            .tabla-contenedor::-webkit-scrollbar {
                height: 8px;
            }

            .tabla-contenedor::-webkit-scrollbar-thumb {
                background: #3498db;
                border-radius: 4px;
            }

            .tabla-contenedor::-webkit-scrollbar-track {
                background: #f1f1f1;
            }
        }

        /* Para pantallas muy pequeñas (hasta 480px) */
        @media (max-width: 480px) {
            .tabla-redes {
                font-size: 11px;
            }

            .tabla-redes th,
            .tabla-redes td {
                padding: 8px 6px;
                min-width: 110px;
            }

            .tabla-redes th:first-child {
                min-width: 60px;
            }

            /* Ajustes específicos de ancho para cada columna en móviles */
            .tabla-redes th:nth-child(1),
            .tabla-redes td:nth-child(1) {
                /* Red # */
                min-width: 70px;
                max-width: 70px;
            }

            .tabla-redes th:nth-child(2),
            .tabla-redes td:nth-child(2) {
                /* Dirección de Red */
                min-width: 130px;
            }

            .tabla-redes th:nth-child(3),
            .tabla-redes td:nth-child(3) {
                /* Primera IP Útil */
                min-width: 130px;
            }

            .tabla-redes th:nth-child(4),
            .tabla-redes td:nth-child(4) {
                /* Última IP Útil */
                min-width: 130px;
            }

            .tabla-redes th:nth-child(5),
            .tabla-redes td:nth-child(5) {
                /* Broadcast */
                min-width: 130px;
            }

            .tabla-redes th:nth-child(6),
            .tabla-redes td:nth-child(6) {
                /* Máscara */
                min-width: 140px;
            }

            .tabla-redes th:nth-child(7),
            .tabla-redes td:nth-child(7) {
                /* Hosts */
                min-width: 90px;
            }
        }

        /* Asegurar que no haya márgenes o paddings que causen espacio blanco */
        .container {
            overflow-x: hidden;
        }

        .tabla-contenedor table {
            margin: 0;
            padding: 0;
            border: 0;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>Calculadora de Rangos de Subred Optimizada</h1>

        <!-- Sección de instrucciones para el usuario -->
        <div class="info">
            <h3>Instrucciones:</h3>
            <p>Ingresa una dirección IP de red y el número de subredes que necesitas. La calculadora detectará
                automáticamente la clase de la red y dividirá todo el rango disponible de direcciones entre las subredes
                solicitadas.</p>
            <p><strong>Ejemplos de IP:</strong> Clase A: 10.0.0.0, Clase B: 172.16.0.0, Clase C: 192.168.1.0</p>
        </div>

        <!-- Formulario de entrada de datos -->
        <div class="input-group">
            <label for="IP">Dirección IP de red:</label>
            <input type="text" id="IP" placeholder="Ej: 192.168.1.0">
            <div class="error" id="errorIP">Por favor ingresa una dirección IP válida (ej: 192.168.1.0)</div>
        </div>

        <div class="input-group">
            <label for="Redes">Número de subredes:</label>
            <input type="number" id="Redes" placeholder="Ej: 5" min="1">
            <div class="error" id="errorRedes">El número de subredes debe ser al menos 1</div>
        </div>

        <!-- Botón para ejecutar el cálculo -->
        <button id="btnEnviar" class="btn">Calcular Rangos de Subred</button>

        <!-- Información sobre las clases de red -->
        <div class="clase-info" id="claseInfo">
            <div class="clase-card clase-a" id="claseA">
                <h3>Clase A</h3>
                <p>Rango: 1.0.0.0 - 126.255.255.255</p>
                <p>Máscara por defecto: 255.0.0.0</p>
                <p>Hosts posibles: 16,777,214</p>
            </div>
            <div class="clase-card clase-b" id="claseB">
                <h3>Clase B</h3>
                <p>Rango: 128.0.0.0 - 191.255.255.255</p>
                <p>Máscara por defecto: 255.255.0.0</p>
                <p>Hosts posibles: 65,534</p>
            </div>
            <div class="clase-card clase-c" id="claseC">
                <h3>Clase C</h3>
                <p>Rango: 192.0.0.0 - 223.255.255.255</p>
                <p>Máscara por defecto: 255.255.255.0</p>
                <p>Hosts posibles: 254</p>
            </div>
        </div>

        <!-- Sección para mostrar detalles de la clase detectada -->
        <div class="detalle-clase" id="detalleClase">
            <!-- Se llenará dinámicamente con JavaScript -->
        </div>

        <!-- Sección de resultados (inicialmente oculta) -->
        <div class="resultados" id="resultados">
            <h2>Resultados</h2>
            <div id="infoResultados"></div>
            <div class="resumen-red" id="resumenRed">
                <!-- Se llenará dinámicamente con JavaScript -->
            </div>
            <div class="tabla-contenedor">
                <table class="tabla-redes" id="tablaRedes">
                    <thead>
                        <tr>
                            <th>Subred #</th>
                            <th>Dirección de Red</th>
                            <th>Primera IP Útil</th>
                            <th>Última IP Útil</th>
                            <th>Dirección de Broadcast</th>
                            <th>Máscara de Subred</th>
                            <th>Hosts Disponibles</th>
                        </tr>
                    </thead>
                    <tbody id="cuerpoTabla">
                        <!-- Las filas se generarán dinámicamente con JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <script>
        // Agregar evento al botón para iniciar el cálculo
        document.getElementById('btnEnviar').addEventListener('click', function () {
            // Obtener valores de los inputs
            const ip = document.getElementById('IP').value.trim();
            const redes = parseInt(document.getElementById('Redes').value);

            // Validar entradas
            let hayErrores = false;

            // Validar IP usando la función validarIP
            const ipValida = validarIP(ip);
            if (!ipValida) {
                document.getElementById('errorIP').style.display = 'block';
                hayErrores = true;
            } else {
                document.getElementById('errorIP').style.display = 'none';
            }

            // Validar número de redes
            if (isNaN(redes) || redes < 1) {
                document.getElementById('errorRedes').style.display = 'block';
                hayErrores = true;
            } else {
                document.getElementById('errorRedes').style.display = 'none';
            }

            // Si hay errores, no continuar con el cálculo
            if (hayErrores) {
                return;
            }

            // Detectar clase de red y calcular rangos
            const clase = detectarClaseIP(ip);
            calcularRangosSubred(ip, redes, clase);
        });

        /**
         * Valida si una cadena es una dirección IP válida
         * @param {string} ip - Dirección IP a validar
         * @returns {boolean} - True si la IP es válida, false en caso contrario
         */
        function validarIP(ip) {
            // Patrón regex para validar formato de IP (4 octetos separados por puntos)
            const patronIP = /^(\d{1,3}\.){3}\d{1,3}$/;
            if (!patronIP.test(ip)) return false;

            // Verificar que cada octeto esté en el rango válido (0-255)
            const octetos = ip.split('.');
            for (let i = 0; i < 4; i++) {
                const octeto = parseInt(octetos[i]);
                if (octeto < 0 || octeto > 255) return false;
            }

            return true;
        }

        /**
         * Detecta la clase de una dirección IP basándose en su primer octeto
         * @param {string} ip - Dirección IP a analizar
         * @returns {string} - Letra que representa la clase (A, B, C, D, E)
         */
        function detectarClaseIP(ip) {
            const primerOcteto = parseInt(ip.split('.')[0]);

            // Clasificación según RFC 791
            if (primerOcteto >= 1 && primerOcteto <= 126) {
                return 'A';
            } else if (primerOcteto >= 128 && primerOcteto <= 191) {
                return 'B';
            } else if (primerOcteto >= 192 && primerOcteto <= 223) {
                return 'C';
            } else if (primerOcteto >= 224 && primerOcteto <= 239) {
                return 'D'; // Multicast
            } else if (primerOcteto >= 240 && primerOcteto <= 255) {
                return 'E'; // Experimental
            } else {
                return 'Desconocida';
            }
        }

        /**
         * Calcula y muestra los rangos de subred para una IP y número de redes dados
         * @param {string} ipBase - Dirección IP base de la red
         * @param {number} numRedes - Número de subredes a crear
         * @param {string} clase - Clase de la red (A, B, C)
         */
        function calcularRangosSubred(ipBase, numRedes, clase) {
            // Resaltar visualmente la clase detectada
            document.querySelectorAll('.clase-card').forEach(card => {
                card.classList.remove('clase-activa');
            });

            if (clase === 'A') {
                document.getElementById('claseA').classList.add('clase-activa');
            } else if (clase === 'B') {
                document.getElementById('claseB').classList.add('clase-activa');
            } else if (clase === 'C') {
                document.getElementById('claseC').classList.add('clase-activa');
            }

            // Mostrar detalles de la clase
            const detalleClase = document.getElementById('detalleClase');
            let mascaraPorDefecto = '';
            let bitsRedPorDefecto = 0;
            let hostsTotales = 0;

            if (clase === 'A') {
                mascaraPorDefecto = '255.0.0.0';
                bitsRedPorDefecto = 8;
                hostsTotales = 16777214;
            } else if (clase === 'B') {
                mascaraPorDefecto = '255.255.0.0';
                bitsRedPorDefecto = 16;
                hostsTotales = 65534;
            } else if (clase === 'C') {
                mascaraPorDefecto = '255.255.255.0';
                bitsRedPorDefecto = 24;
                hostsTotales = 254;
            }

            detalleClase.innerHTML = `
                <h3>Información de la Clase ${clase}</h3>
                <p><strong>IP ingresada:</strong> ${ipBase}</p>
                <p><strong>Clase detectada:</strong> ${clase}</p>
                <p><strong>Máscara por defecto:</strong> ${mascaraPorDefecto}</p>
                <p><strong>Hosts totales disponibles:</strong> ${hostsTotales.toLocaleString()}</p>
            `;
            detalleClase.style.display = 'block';

            // FÓRMULA CORRECTA DE SUBNETTING
            const bitsSubred = Math.ceil(Math.log2(numRedes));
            const subredesPosibles = Math.pow(2, bitsSubred);
            const subredesNoUsadas = subredesPosibles - numRedes;

            // Calcular máscara de subred y CIDR
            const bitsRedPersonalizada = bitsRedPorDefecto + bitsSubred;
            const mascaraPersonalizada = calcularMascara(bitsRedPersonalizada);
            const cidr = `/${bitsRedPersonalizada}`;

            // Calcular tamaño de bloque y hosts
            const bitsHostDisponibles = 32 - bitsRedPorDefecto;
            const bitsHostsPorSubred = bitsHostDisponibles - bitsSubred;
            const tamañoBloque = Math.pow(2, bitsHostsPorSubred);
            const hostsPorSubred = tamañoBloque - 2;
            const totalHostsUtilizados = hostsPorSubred * numRedes;

            // Calcular hosts no utilizados
            const hostsEnSubredesNoUsadas = subredesNoUsadas * tamañoBloque;
            const hostsTotalEnRed = Math.pow(2, bitsHostDisponibles);
            const hostsNoUtilizados = hostsEnSubredesNoUsadas;

            // Verificar si es posible crear las subredes solicitadas
            if (bitsSubred > bitsHostDisponibles) {
                const maxRedes = Math.pow(2, bitsHostDisponibles);
                alert(`Error: La clase ${clase} solo permite crear hasta ${maxRedes} subredes. 
                Has solicitado ${numRedes} subredes, que requieren ${bitsSubred} bits, pero solo hay ${bitsHostDisponibles} bits disponibles.`);
                return;
            }

            // Convertir IP base a número decimal
            const ipBaseDecimal = ipADecimal(ipBase);

            // Generar tabla de resultados
            const cuerpoTabla = document.getElementById('cuerpoTabla');
            cuerpoTabla.innerHTML = '';

            // Información adicional
            let infoSubredesNoUsadas = '';
            if (subredesNoUsadas > 0) {
                infoSubredesNoUsadas = `
                    <p style="color: #e74c3c; font-weight: bold;">
                        ⚠️ Se crearon ${subredesPosibles} subredes posibles, pero solo se usan ${numRedes}.
                        ${subredesNoUsadas} subredes no se utilizan (${hostsNoUtilizados} hosts no disponibles).
                    </p>
                `;
            }

            document.getElementById('infoResultados').innerHTML = `
                <h3>Resumen de la División de Subredes</h3>
                <p>Se han creado ${numRedes} subredes a partir de la red ${ipBase} (Clase ${clase})</p>
                <p><strong>Bits de subred utilizados:</strong> ${bitsSubred}</p>
                <p><strong>Subredes posibles con ${bitsSubred} bits:</strong> ${subredesPosibles}</p>
                ${infoSubredesNoUsadas}
            `;

            // Resumen de la red
            document.getElementById('resumenRed').innerHTML = `
                <div class="resumen-item">
                    <strong>Dirección de red base:</strong> <span>${ipBase}</span>
                </div>
                <div class="resumen-item">
                    <strong>Clase de red:</strong> <span>${clase}</span>
                </div>
                <div class="resumen-item">
                    <strong>Subredes solicitadas:</strong> <span>${numRedes}</span>
                </div>
                <div class="resumen-item">
                    <strong>Subredes creadas:</strong> <span>${subredesPosibles}</span>
                </div>
                <div class="resumen-item">
                    <strong>Subredes no utilizadas:</strong> <span>${subredesNoUsadas}</span>
                </div>
                <div class="resumen-item">
                    <strong>Hosts por subred:</strong> <span>${hostsPorSubred}</span>
                </div>
                <div class="resumen-item">
                    <strong>Total hosts utilizables:</strong> <span>${totalHostsUtilizados.toLocaleString()}</span>
                </div>
                <div class="resumen-item">
                    <strong>Hosts reservados (red+broadcast):</strong> <span>${(2 * numRedes)}</span>
                </div>
                <div class="resumen-item">
                    <strong>Hosts no utilizados:</strong> <span style="color: ${hostsNoUtilizados > 0 ? '#e74c3c' : '#27ae60'}">${hostsNoUtilizados.toLocaleString()}</span>
                </div>
                <div class="resumen-item">
                    <strong>Máscara de subred:</strong> <span>${mascaraPersonalizada} ${cidr}</span>
                </div>
                <div class="resumen-item">
                    <strong>Tamaño de bloque por subred:</strong> <span>${tamañoBloque} direcciones</span>
                </div>
                <div class="resumen-item">
                    <strong>Eficiencia de uso:</strong> <span>${((totalHostsUtilizados / hostsTotales) * 100).toFixed(1)}%</span>
                </div>
            `;

            // Generar información para cada subred
            for (let i = 0; i < numRedes; i++) {
                const direccionRed = ipBaseDecimal + i * tamañoBloque;
                const primeraIPUtil = direccionRed + 1;
                const ultimaIPUtil = direccionRed + tamañoBloque - 2;
                const direccionBroadcast = direccionRed + tamañoBloque - 1;

                // Crear fila de tabla
                const fila = document.createElement('tr');
                fila.innerHTML = `
                    <td>${i + 1}</td>
                    <td>${decimalAIP(direccionRed)}</td>
                    <td>${decimalAIP(primeraIPUtil)}</td>
                    <td>${decimalAIP(ultimaIPUtil)}</td>
                    <td>${decimalAIP(direccionBroadcast)}</td>
                    <td>${mascaraPersonalizada} ${cidr}</td>
                    <td>${hostsPorSubred}</td>
                `;
                cuerpoTabla.appendChild(fila);
            }

            // Mostrar resultados
            document.getElementById('resultados').style.display = 'block';
        }

        function calcularMascara(bitsRed) {
            let mascara = 0;
            for (let i = 0; i < bitsRed; i++) {
                mascara |= (1 << (31 - i));
            }
            return decimalAIP(mascara);
        }

        function ipADecimal(ip) {
            const octetos = ip.split('.');
            return (parseInt(octetos[0]) << 24) +
                (parseInt(octetos[1]) << 16) +
                (parseInt(octetos[2]) << 8) +
                parseInt(octetos[3]);
        }

        function decimalAIP(decimal) {
            return [(decimal >>> 24) & 255,
            (decimal >>> 16) & 255,
            (decimal >>> 8) & 255,
            decimal & 255].join('.');
        }
    </script>
</body>

</html>